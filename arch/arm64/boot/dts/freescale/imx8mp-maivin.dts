// SPDX-License-Identifier: GPL-2.0+ OR MIT
/*
 * Copyright 2021 Au-Zone
 */

/dts-v1/;

#include "imx8mp-verdin.dtsi"
#include "imx8mp-verdin-dev.dtsi"

/ {
	model = "Au-Zone Maivin board";
	compatible = "toradex,verdin-imx8mp-nonwifi",
		     "toradex,verdin-imx8mp",
		     "fsl,imx8mp";

	csi_enable: csi_enable_pin {
		compatible = "regulator-fixed";
		regulator-name = "csi-enable";
		pinctrl-0 = <&pinctrl_csenable>;
		gpio = <&gpio3 7 GPIO_ACTIVE_HIGH>;
		enable-active-high;
	};

	trigger_enable: trigger_enable_pin {
		compatible = "regulator-fixed";
		regulator-name = "trigger_ov5640";
		pinctrl-0 = <&pinctrl_trigger>;
		gpio = <&gpio4 3 GPIO_ACTIVE_HIGH>;
		enable-active-high;
	};
};

/* Disable IEEE power saving */
&ethphy0 {
	eee-broken-100tx;
	eee-broken-1000t;
};

/* Verdin CAN_1 */
&flexcan1 {
	status = "okay";
};

/* Verdin CAN_2 */
&flexcan2 {
	status = "okay";
};

/* Verdin I2C_2_DSI */
&i2c2 {
	clock-frequency = <400000>;
	scl-gpios = <&gpio5 16 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
	sda-gpios = <&gpio5 17 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
};

/* Verdin I2C_4_CSI */
&i2c3 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";

	ov5640_0: ov5640_mipi@3c {
		assigned-clocks = <&clk IMX8MP_CLK_IPP_DO_CLKO2>;
		assigned-clock-parents = <&clk IMX8MP_CLK_24M>;
		assigned-clock-rates = <24000000>;
		AVDD-supply = <&csi_enable>;
		DVDD-supply = <&csi_enable>;
		DOVDD-supply = <&trigger_enable>;
		compatible = "ovti,ov5640";
		clock-names = "xclk";
		clocks = <&clk IMX8MP_CLK_IPP_DO_CLKO2>;
		csi_id = <0>;
		mclk = <24000000>;
		mclk_source = <0>;
		mipi_csi;
		pinctrl-names = "default";
		reg = <0x3c>;

		port {
			ov5640_mipi_0_ep: endpoint {
				clock-lanes = <0>;
				data-lanes = <1 2>;
				remote-endpoint = <&mipi_csi0_ep>;
			};
		};
	};
};

/* Verdin I2C_1 */
&i2c4 {
	temp_sensor: tmp102@4b {
		compatible = "ti,tmp102", "tmp102";
		reg = <0x4b>;
	};

	/* To be compatible with old versions of the board */
	temp_sensor_old: tmp102@4a {
		compatible = "ti,tmp102", "tmp102";
		reg = <0x4a>;
	};

	/* EEPROM on the rear connector interface */
	eeprom@54 {
		compatible = "st,24c02";
		pagesize = <16>;
		reg = <0x54>;
	};

	cpu_eeprom@57 {
		compatible = "st,24c02";
		pagesize = <16>;
		reg = <0x57>;
	};
};

&iomuxc {
	pinctrl-0 = <&pinctrl_gpio1>, <&pinctrl_gpio2>,
		    <&pinctrl_gpio3>, <&pinctrl_gpio4>,
		    <&pinctrl_gpio_hog1>, <&pinctrl_gpio_hog2>, <&pinctrl_gpio_hog3>,
		    <&pinctrl_hdmi_hog>, <&pinctrl_pmic_tpm_ena>;

	pinctrl_flexspi0: flexspi0grp {
		fsl,pins = <
			MX8MP_IOMUXC_NAND_READY_B__GPIO3_IO16		0x1C4	/* SODIMM 64 */
			/*
			 * Setting bit 8(Pull up select field) high to enable pull
			 * Setting bit 7(Input select field) high to use Schmitt
			 * Setting bit 2(Drive strength field) high
			 * Setting bit 6(Pull Up/Down config field) high
			 * This needs to be a pull up since when the SW1 switch is pressed it is
			 * shorting this pin to ground
			 */

			MX8MP_IOMUXC_NAND_DATA00__FLEXSPI_A_DATA00	0x82	/* SODIMM 56 */
			MX8MP_IOMUXC_NAND_DATA03__FLEXSPI_A_DATA03	0x82	/* SODIMM 62 */
		>;
	};

	/* Used to enable DAC U5 output */
	pinctrl_pwm_1: pwm1grp {
		fsl,pins = <
			MX8MP_IOMUXC_SPDIF_EXT_CLK__GPIO5_IO05		0x184	/* SODIMM 15 */
		>;
	};

	/* Used to enable DAC U6 output */
	pinctrl_pwm_2: pwm2grp {
		fsl,pins = <
			MX8MP_IOMUXC_GPIO1_IO11__GPIO1_IO11		0x184	/* SODIMM 16 */
		>;
	};

	led_control: led {
		fsl,pins = <
			MX8MP_IOMUXC_NAND_DQS__GPIO3_IO14		0x82	/* SODIMM 66 */
		>;
	};

	led_wdi_control: led_wdi {
		fsl,pins = <
			MX8MP_IOMUXC_NAND_DATA02__GPIO3_IO08		0x82	/* SODIMM 60 */
		>;
	};

	Watchdog_control: WDI {
		fsl,pins = <
			MX8MP_IOMUXC_NAND_ALE__GPIO3_IO00		0x82	/* SODIMM 52 */
		>;
	};

	M2_PWR_EN_Control: M2_PWR_EN {
		fsl,pins = <
			MX8MP_IOMUXC_NAND_CE0_B__GPIO3_IO01		0x82	/* SODIMM 54 */
		>;
	};

	pinctrl_csenable: csenable {
		fsl,pins = <
			MX8MP_IOMUXC_NAND_DATA01__GPIO3_IO07		0x184	/* SODIMM 58 */
		>;
	};

	pinctrl_trigger: trigger {
		fsl,pins = <
			MX8MP_IOMUXC_SAI1_RXD1__GPIO4_IO03		0x184	/* SODIMM 220 */
		>;
	};

	pinctrl_trigger_2: trigger_2 {
		fsl,pins = <
			MX8MP_IOMUXC_SAI1_RXC__GPIO4_IO01		0x184	/* SODIMM 222 */
		>;
	};
};

&mipi_csi_0 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";

	port@0 {
		reg = <0>;

		mipi_csi0_ep: endpoint {
			csis-hs-settle = <13>;
			csis-clk-settle = <2>;
			csis-wclk;
			data-lanes = <2>;
			remote-endpoint = <&ov5640_mipi_0_ep>;
		};
	};
};

/* Verdin UART_1 */
/* Enabling RS-245 operation */
&uart1 {
	fsl,uart-has-rtscts;
	linux,rs485-enabled-at-boot-time;
};
